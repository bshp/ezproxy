#!/bin/bash
    
function app_shutdown()
{
    /usr/sbin/ezproxy stop;
}
    
function app_reload()
{

    app_shutdown;
    app_start;
}
    
function app_start()
{
   /usr/sbin/ezproxy -d ${APP_DATA};
}
    
function app_certs()
{
    ${OCIE_LIB}/cacerts;
}
    
function app_config()
{
    if [[ "${HOSTNAME}" != *.* ]];then
        echo "EzProxy requires the hostname be a fully-qualified domain name";
        echo "Set your FQDN during runtime, e.g --hostname something.example.com";
    fi;
    
    echo "Generating EzProxy Config";
    /usr/sbin/ezproxy -d ${APP_DATA} -m >/dev/null;
    
    if [[ -z "${WSKEY}" ]];then
        echo "EzProxy requires a license key, set it during runtime with -e WSKEY='mykeyfromoclc'";
        echo "Container will now exit";
        exit 1;
    fi;
    if [[ ! -f "${APP_HOME}/wskey.key" ]];then
        echo "Installing license file";
        /usr/sbin/ezproxy -k "${WSKEY}" >/dev/null;
    fi;
}
